{
  "type": "prd",
  "morgoth": "large",
  "status": "approved",
  "domain": "frontend",
  "name": "static-notes",
  "title": "Static Notes",
  "created": "2026-02-04T00:00:00Z",
  "updated": "2026-02-04T00:00:00Z",
  "problem": {
    "surface_request": "Single index.html file note app with data encoded in URL for sharing",
    "root_problem": "Users need instant note sharing without accounts, servers, or data retention concerns",
    "affected": "End users, developers, teams, personal use",
    "impact": "Without this, users must rely on external services with accounts, storage costs, and privacy concerns"
  },
  "outcome": "Single index.html with inline CSS/JS that encodes note content into URL hash using lz-string compression",
  "boundaries": {
    "in_scope": [
      "Single HTML file with inline CSS and JS",
      "URL-encoded note content using lz-string",
      "Contenteditable editor with basic formatting",
      "Live URL preview with debounced updates",
      "Share button with copy-to-clipboard",
      "QR code generation",
      "Keyboard shortcuts",
      "Character/byte counter",
      "Dark/light mode via system preference",
      "Mobile responsive layout"
    ],
    "out_of_scope": [
      { "item": "Server-side storage", "reason": "Defeats purpose of URL-only sharing", "status": "rejected" },
      { "item": "User accounts", "reason": "No server, no accounts needed", "status": "rejected" },
      { "item": "Real-time collaboration", "reason": "Single-user, static file", "status": "deferred" },
      { "item": "Full rich text editor", "reason": "Keep it simple, basic formatting only", "status": "deferred" },
      { "item": "File attachments", "reason": "URL length limits", "status": "rejected" },
      { "item": "Markdown rendering", "reason": "Future enhancement", "status": "deferred" },
      { "item": "URL shortening integration", "reason": "External dependency, users can do manually", "status": "deferred" }
    ]
  },
  "assumptions": [
    { "assumption": "lz-string library provides sufficient compression for typical notes", "status": "validated", "impact": "high" },
    { "assumption": "Users will share URLs via messaging apps that preserve full URL", "status": "unknown", "impact": "medium" },
    { "assumption": "Browser URL limits of ~8000 chars are sufficient for most use cases", "status": "validated", "impact": "high" },
    { "assumption": "System prefers-color-scheme is widely supported", "status": "validated", "impact": "low" }
  ],
  "acceptance_criteria": [
    "Single HTML file with no external dependencies (lz-string inlined)",
    "Note content survives encode/decode round-trip",
    "URL updates within 500ms of typing",
    "Works offline once loaded",
    "Mobile responsive down to 320px viewport",
    "Dark mode activates via system preference"
  ],
  "success_criteria": [
    "User can write a note and share it via URL",
    "Recipient opens URL and sees the exact same note content",
    "App works completely offline after initial load",
    "URL stays under 8000 chars for typical notes with compression",
    "QR code is scannable and loads the note"
  ],
  "requirements": [
    { "id": "R1", "requirement": "Encode note content to URL hash using lz-string compression", "priority": "P0", "moscow": "must" },
    { "id": "R2", "requirement": "Decode URL hash and display note on page load", "priority": "P0", "moscow": "must" },
    { "id": "R3", "requirement": "Provide contenteditable editor with native undo/redo", "priority": "P0", "moscow": "must" },
    { "id": "R4", "requirement": "Update URL in real-time as user types (debounced 500ms)", "priority": "P0", "moscow": "must" },
    { "id": "R5", "requirement": "Copy URL to clipboard on Share button click", "priority": "P0", "moscow": "must" },
    { "id": "R6", "requirement": "Display character count and URL length", "priority": "P1", "moscow": "should" },
    { "id": "R7", "requirement": "Show warning when URL exceeds 2000/8000 chars", "priority": "P1", "moscow": "should" },
    { "id": "R8", "requirement": "Support bold/italic formatting", "priority": "P1", "moscow": "should" },
    { "id": "R9", "requirement": "Generate QR code from current URL", "priority": "P1", "moscow": "should" },
    { "id": "R10", "requirement": "Keyboard shortcuts for common actions", "priority": "P2", "moscow": "could" },
    { "id": "R11", "requirement": "Auto dark/light mode via prefers-color-scheme", "priority": "P1", "moscow": "should" },
    { "id": "R12", "requirement": "Mobile responsive layout", "priority": "P0", "moscow": "must" }
  ],
  "user_journeys": [
    {
      "name": "Create and Share Note",
      "actor": "Note Creator",
      "goal": "Share a quick note via URL",
      "steps": [
        "Open index.html in browser",
        "Type or paste content in editor",
        "See URL update in status bar",
        "Click Share button or press Ctrl+S",
        "URL copied to clipboard",
        "Paste and share via any medium"
      ],
      "edge_cases": [
        "Very long note exceeds URL limits",
        "Special characters or unicode in note",
        "Empty note"
      ]
    },
    {
      "name": "View Shared Note",
      "actor": "Note Recipient",
      "goal": "Read a note shared via URL",
      "steps": [
        "Receive URL from sender",
        "Click or paste URL in browser",
        "Note content loads automatically",
        "Optionally edit and re-share with new URL"
      ],
      "edge_cases": [
        "Corrupted or truncated URL",
        "Old browser without lz-string support"
      ]
    },
    {
      "name": "QR Code Sharing",
      "actor": "Note Creator",
      "goal": "Share note via QR code for mobile",
      "steps": [
        "Write note in editor",
        "Click QR code button",
        "QR modal appears with scannable code",
        "Recipient scans with phone camera",
        "Note opens in mobile browser"
      ],
      "edge_cases": [
        "URL too long for QR code",
        "Low contrast QR code in dark mode"
      ]
    },
    {
      "name": "URL Shortener Workaround",
      "actor": "Note Creator",
      "goal": "Share long note that exceeds URL limits",
      "steps": [
        "Write longer note, see yellow/red warning",
        "Copy the full long URL",
        "Paste into Bitly/TinyURL",
        "Get shortened link",
        "Share shortened link"
      ],
      "edge_cases": [
        "Shortener service down",
        "Free tier limits exceeded"
      ]
    }
  ],
  "tasks": [
    {
      "id": "1",
      "name": "Foundation: HTML Structure and Base Styles",
      "description": "Create the base HTML structure with semantic elements, CSS reset, theme variables for light/dark mode, and responsive layout scaffolding.",
      "acceptance_criteria": "HTML file renders with header, editor area, toolbar, status bar, and action buttons. Dark/light mode switches based on system preference. Layout is responsive.",
      "test": "Open in browser, verify all sections render. Toggle system dark mode and verify theme changes. Resize to 320px and verify layout adapts.",
      "priority": "P0",
      "estimate": { "size": "M", "time": "2-3 hours" },
      "subtasks": [
        { "id": "1.1", "action": "Create base HTML structure with semantic elements in index.html", "acceptance_criteria": "HTML has doctype, head with meta viewport, body with header, main, footer sections" },
        { "id": "1.2", "action": "Add CSS reset and theme variables for light/dark mode", "acceptance_criteria": "CSS variables defined for colors, spacing. prefers-color-scheme media query toggles theme." },
        { "id": "1.3", "action": "Implement responsive layout with CSS Grid/Flexbox", "acceptance_criteria": "Layout works from 320px to desktop. No horizontal scroll." },
        { "id": "1.4", "action": "Add contenteditable div with placeholder styling", "acceptance_criteria": "Editor shows placeholder when empty, removes on focus/input." }
      ]
    },
    {
      "id": "2",
      "name": "Core Encoding: lz-string Integration",
      "description": "Integrate lz-string library (inlined), implement encode/decode functions, wire up URL hash sync.",
      "acceptance_criteria": "Typing in editor updates URL hash. Opening URL with hash populates editor with decoded content. Round-trip preserves content exactly.",
      "test": "Type 'Hello World', verify URL hash changes. Copy URL, open in new tab, verify 'Hello World' appears. Test with special chars and unicode.",
      "priority": "P0",
      "estimate": { "size": "M", "time": "2-3 hours" },
      "subtasks": [
        { "id": "2.1", "action": "Inline lz-string library in script tag", "acceptance_criteria": "LZString object available globally, no external requests" },
        { "id": "2.2", "action": "Implement encode(text) function using compressToEncodedURIComponent", "acceptance_criteria": "Function returns URL-safe compressed string" },
        { "id": "2.3", "action": "Implement decode(hash) function using decompressFromEncodedURIComponent", "acceptance_criteria": "Function returns original text from compressed hash" },
        { "id": "2.4", "action": "Add debounced URL update on editor input (500ms)", "acceptance_criteria": "URL updates 500ms after typing stops, not on every keystroke" },
        { "id": "2.5", "action": "Load and decode content from URL hash on page load", "acceptance_criteria": "Page load with hash populates editor with decoded content" }
      ]
    },
    {
      "id": "3",
      "name": "Status Bar and Feedback",
      "description": "Implement character counter, URL length indicator, warning thresholds, and copy-to-clipboard functionality.",
      "acceptance_criteria": "Status bar shows live character count and URL length. Yellow warning at 2000 chars, red at 8000. Share button copies URL and shows feedback.",
      "test": "Type text, verify counters update. Paste long text until warnings appear. Click Share, verify clipboard contains URL.",
      "priority": "P0",
      "estimate": { "size": "S", "time": "1-2 hours" },
      "subtasks": [
        { "id": "3.1", "action": "Add character counter that updates on input", "acceptance_criteria": "Counter shows current text length, updates in real-time" },
        { "id": "3.2", "action": "Add URL length indicator", "acceptance_criteria": "Shows current URL length including hash" },
        { "id": "3.3", "action": "Implement warning thresholds with visual feedback", "acceptance_criteria": "Yellow styling at 2000 chars, red at 8000 chars" },
        { "id": "3.4", "action": "Implement copy-to-clipboard for Share button", "acceptance_criteria": "Click copies URL, shows 'Copied!' feedback for 2 seconds" }
      ]
    },
    {
      "id": "4",
      "name": "Formatting Toolbar",
      "description": "Add formatting toolbar with bold/italic buttons, implement execCommand, ensure formatting survives encoding.",
      "acceptance_criteria": "Bold and italic buttons work. Formatted text encodes to URL and decodes back with formatting preserved.",
      "test": "Select text, click Bold, verify bold. Encode, decode, verify still bold. Same for italic.",
      "priority": "P1",
      "estimate": { "size": "S", "time": "1-2 hours" },
      "subtasks": [
        { "id": "4.1", "action": "Add formatting toolbar with Bold and Italic buttons", "acceptance_criteria": "Toolbar renders above or below editor with B and I buttons" },
        { "id": "4.2", "action": "Implement execCommand for bold and italic", "acceptance_criteria": "Clicking buttons toggles formatting on selected text" },
        { "id": "4.3", "action": "Ensure innerHTML encoding preserves formatting", "acceptance_criteria": "Encode editor.innerHTML, decode, verify HTML tags preserved" }
      ]
    },
    {
      "id": "5",
      "name": "Keyboard Shortcuts",
      "description": "Implement keyboard shortcuts for copy URL, clear note, and formatting.",
      "acceptance_criteria": "Ctrl+S copies URL, Ctrl+L clears note, Ctrl+B/I toggle formatting. Works on Mac with Cmd.",
      "test": "Press each shortcut, verify expected action. Test on Mac if available.",
      "priority": "P1",
      "estimate": { "size": "S", "time": "1 hour" },
      "subtasks": [
        { "id": "5.1", "action": "Implement Ctrl/Cmd+S to copy URL", "acceptance_criteria": "Shortcut copies URL to clipboard, prevents default save dialog" },
        { "id": "5.2", "action": "Implement Ctrl/Cmd+L to clear note", "acceptance_criteria": "Shortcut clears editor and URL hash" },
        { "id": "5.3", "action": "Implement Ctrl/Cmd+B and Ctrl/Cmd+I for formatting", "acceptance_criteria": "Shortcuts toggle bold/italic on selection" }
      ]
    },
    {
      "id": "6",
      "name": "QR Code Generation",
      "description": "Add QR code generation library (inlined), create modal, generate QR from current URL.",
      "acceptance_criteria": "QR button opens modal with scannable QR code. Modal can be closed. QR encodes current URL.",
      "test": "Click QR button, verify modal opens. Scan QR with phone, verify it opens the note URL. Close modal.",
      "priority": "P1",
      "estimate": { "size": "M", "time": "2-3 hours" },
      "subtasks": [
        { "id": "6.1", "action": "Inline QR code generation library (qrcode-generator)", "acceptance_criteria": "QR generation available without external requests" },
        { "id": "6.2", "action": "Create QR modal with close button and backdrop", "acceptance_criteria": "Modal centers on screen, backdrop dims page, X button closes" },
        { "id": "6.3", "action": "Generate QR code on button click from current URL", "acceptance_criteria": "QR code renders in modal, encodes window.location.href" },
        { "id": "6.4", "action": "Handle long URLs gracefully", "acceptance_criteria": "Show warning if URL too long for QR, still generate if possible" }
      ]
    },
    {
      "id": "7",
      "name": "Polish and Testing",
      "description": "Final polish including mobile testing, cross-browser testing, loading states, and CSS refinements.",
      "acceptance_criteria": "App works on mobile Safari/Chrome, desktop Chrome/Firefox/Safari/Edge. Smooth animations, polished UI.",
      "test": "Test on multiple devices and browsers. Verify all features work. Check accessibility basics.",
      "priority": "P1",
      "estimate": { "size": "M", "time": "2-3 hours" },
      "subtasks": [
        { "id": "7.1", "action": "Test and fix mobile responsiveness issues", "acceptance_criteria": "Works on iOS Safari, Android Chrome at 320px minimum" },
        { "id": "7.2", "action": "Test and fix dark/light mode transitions", "acceptance_criteria": "Theme switch is smooth, no flash of wrong theme" },
        { "id": "7.3", "action": "Cross-browser testing and fixes", "acceptance_criteria": "Works on Chrome, Firefox, Safari, Edge latest versions" },
        { "id": "7.4", "action": "Add loading state for initial decode", "acceptance_criteria": "Show brief loading indicator while decoding long URLs" },
        { "id": "7.5", "action": "Final CSS polish and micro-animations", "acceptance_criteria": "Buttons have hover/active states, focus rings visible, smooth transitions" }
      ]
    }
  ],
  "dependencies": {
    "task_deps": [
      { "task": "2", "depends_on": "1" },
      { "task": "3", "depends_on": "2" },
      { "task": "4", "depends_on": "1" },
      { "task": "5", "depends_on": ["3", "4"] },
      { "task": "6", "depends_on": "2" },
      { "task": "7", "depends_on": ["3", "4", "5", "6"] }
    ],
    "external_deps": [],
    "critical_path": ["1", "2", "3", "5", "7"],
    "critical_path_duration": "8-12 hours",
    "parallel_tracks": [
      { "name": "Core", "tasks": ["1", "2", "3"] },
      { "name": "Features", "tasks": ["4", "5", "6"] }
    ]
  },
  "estimation": {
    "method": "t-shirt",
    "total_effort": "12-17 hours",
    "buffer": "3 hours",
    "total_with_buffer": "15-20 hours"
  },
  "risks": [
    { "risk": "URL length limits break sharing in some apps", "probability": "medium", "impact": "medium", "mitigation": "Show clear warnings, document URL shortener workaround" },
    { "risk": "lz-string compression insufficient for large notes", "probability": "low", "impact": "medium", "mitigation": "Test with realistic content, document limits" },
    { "risk": "contenteditable behavior varies across browsers", "probability": "medium", "impact": "low", "mitigation": "Test thoroughly, use execCommand which is well-supported" },
    { "risk": "QR codes fail for very long URLs", "probability": "medium", "impact": "low", "mitigation": "Show warning, still generate QR which may work" }
  ],
  "test_requirements": [
    { "type": "unit", "description": "Test encode/decode functions with various inputs including empty, unicode, special chars" },
    { "type": "integration", "description": "Full round-trip: type -> encode -> copy URL -> new tab -> decode -> verify content" },
    { "type": "e2e", "description": "User flows: create note, share, view shared, QR code scan" },
    { "type": "visual", "description": "Mobile responsive at 320px, dark/light mode, button states" }
  ],
  "nfr": {
    "performance": {
      "initial_load": "<100ms",
      "encode_decode": "<50ms for typical notes"
    },
    "bundle_size": "<50KB total (HTML + inline CSS + inline JS)",
    "browser_support": ["Chrome 90+", "Firefox 90+", "Safari 14+", "Edge 90+"],
    "accessibility": "Basic keyboard navigation and focus states"
  },
  "technical_approach": {
    "architecture": "Single HTML file with inline CSS in <style> and inline JS in <script>. No build step, no external dependencies.",
    "component_structure": "Header (title) -> Editor (contenteditable) -> Toolbar (formatting) -> Status bar (counters, warnings) -> Actions (Share, QR, Clear) -> QR Modal",
    "data_models": [
      {
        "name": "NoteState",
        "fields": {
          "content": "string (innerHTML of editor)",
          "encoded": "string (lz-string compressed)",
          "charCount": "number",
          "urlLength": "number"
        }
      }
    ]
  },
  "phase_gates": [
    {
      "name": "GATE: Core MVP",
      "acceptance_criteria": [
        "Can type in editor",
        "URL updates with encoded content",
        "Opening URL displays decoded content",
        "Share button copies URL"
      ]
    },
    {
      "name": "GATE: Feature Complete",
      "acceptance_criteria": [
        "Formatting works and persists",
        "QR code generates and scans",
        "Keyboard shortcuts work",
        "Warnings display correctly"
      ]
    },
    {
      "name": "GATE: Release Ready",
      "acceptance_criteria": [
        "Mobile responsive verified",
        "Cross-browser tested",
        "Dark/light mode works",
        "All polish items complete"
      ]
    }
  ],
  "references": [
    "https://github.com/pieroxy/lz-string",
    "https://pieroxy.net/blog/pages/lz-string/index.html",
    "https://github.com/kazuhikoarase/qrcode-generator",
    "https://leanrada.com/notes/compressing-websites-into-urls/"
  ],
  "discovery": {
    "skills": [
      { "name": "frontend-design", "domain": "frontend", "used_by_tasks": ["1", "7"], "load_command": "/frontend-design" }
    ],
    "agents": [],
    "docs": []
  },
  "user_tips": [
    {
      "id": "url_shortener",
      "title": "URL Shortener Workaround",
      "description": "For long notes exceeding ~2000 chars, paste the full URL into Bitly or TinyURL. These services store the complete original URL and redirect to it, preserving all encoded note data."
    }
  ]
}
